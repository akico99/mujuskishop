<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ë¬´ì£¼ìŠ¤í‚¤ìƒµ ê²¬ì /ì˜ˆì•½</title>
  <style>

    select option {  
        color: #111;          /* í¼ì³¤ì„ ë•Œ ê¸€ìëŠ” ê²€ì • */
        background: #fff;     /* ë°°ê²½ í°ìƒ‰ */
    }
    :root { --bg:#0b0c10; --card:#12141a; --muted:#9aa3b2; --text:#e8ecf3; --line:#242a36; --accent:#5eead4; --warn:#ffcf66; }
    * { box-sizing: border-box; }
    body { margin:0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Apple SD Gothic Neo, Noto Sans KR, sans-serif; background: linear-gradient(180deg, #0b0c10, #0b0c10 40%, #0a1220); color:var(--text); }
    .wrap { max-width: 980px; margin: 0 auto; padding: 18px 14px 90px; }
    header { display:flex; gap:12px; align-items:flex-end; justify-content:space-between; margin-bottom: 12px; }
    h1 { margin:0; font-size: 18px; letter-spacing:-0.2px; }
    .sub { color: var(--muted); font-size: 12px; }

    .tabs { display:flex; gap:10px; margin: 14px 0 12px; }
    .tabbtn { flex:1; border:1px solid var(--line); background: rgba(255,255,255,0.02); color:var(--text);
      padding: 12px 10px; border-radius: 12px; cursor:pointer; font-weight: 700; }
    .tabbtn.active { border-color: rgba(94,234,212,0.5); box-shadow: 0 0 0 3px rgba(94,234,212,0.12) inset; }

    .grid { display:grid; grid-template-columns: 1fr; gap: 12px; }
    @media (min-width: 860px) { .grid { grid-template-columns: 1.1fr 0.9fr; align-items:start; } }

    .card { background: rgba(18,20,26,0.92); border: 1px solid var(--line); border-radius: 16px; padding: 14px; }
    .card h2 { margin: 0 0 10px; font-size: 14px; color: #dfe6f3; }
    .row { display:flex; gap:10px; flex-wrap:wrap; }
    .field { display:flex; flex-direction:column; gap:6px; flex:1; min-width: 160px; }
    label { font-size: 12px; color: var(--muted); }
    input[type="text"], input[type="tel"], input[type="time"], input[type="date"], textarea, select {
      background: rgba(255,255,255,0.03); border:1px solid var(--line); color:var(--text);
      padding: 10px 10px; border-radius: 12px; outline:none;
    }
    textarea { min-height: 90px; resize: vertical; }

    .seg { display:flex; gap:8px; flex-wrap:wrap; }
    .seg label { display:flex; align-items:center; gap:6px; padding: 10px 10px; border:1px solid var(--line); border-radius: 12px;
      background: rgba(255,255,255,0.02); cursor:pointer; user-select:none; }
    .seg input { accent-color: var(--accent); }

    .step { display:flex; align-items:center; gap:10px; justify-content:space-between; flex-wrap: wrap; padding: 10px 10px; border: 1px solid var(--line); border-radius: 12px; background: rgba(255,255,255,0.02); }
    .step .left { display:flex; flex-direction:column; gap:2px; min-width: 0; }
    .step .name { font-weight: 700; font-size: 13px; }
    .step .hint { color: var(--muted); font-size: 12px; word-break: keep-all; }
    .step .ctrl { display:flex; align-items:center; gap:8px; flex-shrink: 0; }
    .btn { border:1px solid var(--line); background: rgba(255,255,255,0.03); color:var(--text);
      padding: 10px 10px; border-radius: 12px; cursor:pointer; font-weight: 800; }
    .btn:active { transform: translateY(1px); }
    .btn.primary { border-color: rgba(94,234,212,0.6); box-shadow: 0 0 0 3px rgba(94,234,212,0.10) inset; }
    .btn.danger { border-color: rgba(255,99,132,0.35); }
    .mini { width: 38px; height: 34px; padding:0; display:grid; place-items:center; font-size: 18px; }
    .count { min-width: 28px; text-align:center; font-weight: 900; }
    .pill { display:inline-flex; align-items:center; gap:8px; padding: 8px 10px; border:1px solid var(--line); border-radius: 999px; background: rgba(255,255,255,0.02); color: #dbe4f3; font-size: 12px; }

    .stickyTotal {
      position: sticky; top: 10px; z-index: 2;
      display:flex; flex-direction:column; gap: 10px;
    }
    .totalBox { border:1px solid rgba(94,234,212,0.35); border-radius: 16px; padding: 14px;
      background: radial-gradient(1200px 200px at 0% 0%, rgba(94,234,212,0.14), rgba(18,20,26,0.92)); }
    .totalLabel { color: var(--muted); font-size: 12px; }
    .totalValue { font-size: 28px; font-weight: 950; letter-spacing: -0.6px; margin-top: 4px; }
    .note { color: var(--muted); font-size: 12px; line-height: 1.5; }
    .warn { color: var(--warn); font-size: 12px; line-height: 1.5; }

    details { border:1px solid var(--line); border-radius: 14px; background: rgba(255,255,255,0.02); padding: 10px 12px; }
    details > summary { cursor:pointer; font-weight: 800; }
    .breakdown { margin-top: 10px; font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace; font-size: 12px; white-space: pre-wrap; color: #dbe4f3; }
    .outBox { width:100%; }
    .toast { position: fixed; left: 50%; bottom: 18px; transform: translateX(-50%); background: rgba(18,20,26,0.96);
      border:1px solid var(--line); padding: 10px 12px; border-radius: 999px; color: var(--text); font-weight: 800; display:none; }
    input[type="date"]::-webkit-calendar-picker-indicator{
        filter: invert(1);
        opacity: .9;
    }

    /* ì»¤ìŠ¤í…€ ë‹¬ë ¥ ë²„íŠ¼ìš© (1ë²ˆ ë°©ì‹ ì„ íƒ ì‹œ) */
    .dateWrap{ position:relative; }
    .dateWrap input[type="date"]{ width:100%; padding-right:44px; }
    .dateBtn{
    position:absolute; right:8px; top:50%; transform:translateY(-50%);
    width:34px; height:34px; border-radius:10px;
    border:1px solid var(--line);
    background: rgba(255,255,255,0.06);
    color: var(--text);
    cursor:pointer;
    }
    .dateWrap input[type="date"]::-webkit-calendar-picker-indicator{
    opacity: 0;
    display: none;
    }
    .dateWrap input[type="date"]::-webkit-inner-spin-button{
    display:none;
    }
  </style>
</head>

<body>
  <div class="wrap">
    <header>
      <div>
        <h1>ë¬´ì£¼ìŠ¤í‚¤ìƒµ ê²¬ì /ì˜ˆì•½ ê³„ì‚°ê¸°</h1>
        <div class="sub">ì €ì¥ ê¸°ëŠ¥ ì—†ì´, ì‹¤ì‹œê°„ ê²¬ì  + ë³µì‚¬ë§Œ ë˜ëŠ” ê°€ë²¼ìš´ ë²„ì „</div>
      </div>
      <div class="pill" id="dayTypePill">ì´ìš©ì¼ ë¯¸ì„ íƒ</div>
    </header>

    <div class="tabs">
      <button class="tabbtn active" id="tabQuote">ê²¬ì ë‚´ê¸°</button>
      <button class="tabbtn" id="tabReserve">ì˜ˆì•½ì •ë³´ ì…ë ¥</button>
    </div>

    <!-- ê²¬ì ë‚´ê¸° -->
    <section id="viewQuote" class="grid">
      <div class="card">
        <h2>|ë§¤ì¥ ì„ íƒ|</h2>
        <div class="seg" id="shopSeg">
        <label><input type="radio" name="shop" value="choice" checked> ì´ˆì´ìŠ¤</label>
        <label><input type="radio" name="shop" value="sky"> ìŠ¤ì¹´ì´</label>
        <label><input type="radio" name="shop" value="national"> êµ­ëŒ€</label>
        </div>

        <div style="height:14px"></div>
        <h2>0) ê¸°íƒ€ì‚¬í•­ (ì§ˆë¬¸/ë‹µë³€)</h2>

        <div class="row">
          <div class="field" style="max-width:220px;">
            <label>ì§ˆë¬¸ ê°œìˆ˜</label>
            <select id="q_faqCount">
              <option value="0" selected>0ê°œ</option>
              <option value="1">1ê°œ</option>
              <option value="2">2ê°œ</option>
              <option value="3">3ê°œ</option>
              <option value="4">4ê°œ</option>
              <option value="5">5ê°œ</option>
            </select>
          </div>

          <div class="field" style="min-width:240px;">
            <label>ì•ˆë‚´</label>
            <input type="text" value="ì„ íƒí•œ ê°œìˆ˜ë§Œí¼ ì§ˆë¬¸/ë‹µë³€ ì…ë ¥ë€ì´ ìƒì„±ë©ë‹ˆë‹¤." readonly />
          </div>
        </div>

        <div id="faqWrap" style="margin-top:10px;"></div>
        <h2>1) ì´ìš©ì¼ / ì¸ì›</h2>
        <div class="row">
        <div class="field">
            <label>ì´ìš©ì¼ (ë‹¬ë ¥ ì„ íƒ)</label>

            <!-- dateWrap ì•ˆì— input + buttonì„ ê°™ì´ ë„£ì–´ì•¼ í•¨ -->
            <div class="dateWrap">
            <input type="date" id="q_date" />
            <button type="button" class="dateBtn" aria-label="ë‹¬ë ¥ ì—´ê¸°">ğŸ“…</button>
            </div>
        </div>

        <div class="field">
            <label>í‘œì‹œ</label>
            <input type="text" id="q_dateLabel" placeholder="YYYY-MM-DD (ìš”ì¼ Â· ì£¼ì¤‘/ì£¼ë§)" readonly />
        </div>
        </div>

        <div style="height:10px"></div>


        <div style="height:12px"></div>
        <div class="pill"> ë¦¬í”„íŠ¸ ì¸ì›: <b id="q_totalPeople">0</b>ëª… </div>

        <div style="height:16px"></div>
        <h2>2) ë¦¬í”„íŠ¸ê¶Œ</h2>
        <div class="step">
            <div class="left">
                <div class="name">3ì‹œê°„ê¶Œ</div>
                <div class="hint">ëŒ€ì¸ / ì†Œì¸ ì„ íƒ</div>
            </div>
            <div class="ctrl">
                ëŒ€ì¸
                <button class="btn mini" data-step="q_lift3_adult" data-delta="-1">âˆ’</button>
                <div class="count" id="q_lift3_adult">0</div>
                <button class="btn mini" data-step="q_lift3_adult" data-delta="1">+</button>

                ì†Œì¸
                <button class="btn mini" data-step="q_lift3_child" data-delta="-1">âˆ’</button>
                <div class="count" id="q_lift3_child">0</div>
                <button class="btn mini" data-step="q_lift3_child" data-delta="1">+</button>
            </div>
            </div>

            <!-- 4ì‹œê°„ê¶Œ -->
            <div class="step">
            <div class="left">
                <div class="name">4ì‹œê°„ê¶Œ</div>
            </div>
            <div class="ctrl">
                ëŒ€ì¸
                <button class="btn mini" data-step="q_lift4_adult" data-delta="-1">âˆ’</button>
                <div class="count" id="q_lift4_adult">0</div>
                <button class="btn mini" data-step="q_lift4_adult" data-delta="1">+</button>

                ì†Œì¸
                <button class="btn mini" data-step="q_lift4_child" data-delta="-1">âˆ’</button>
                <div class="count" id="q_lift4_child">0</div>
                <button class="btn mini" data-step="q_lift4_child" data-delta="1">+</button>
            </div>
            </div>

            <!-- 6ì‹œê°„ê¶Œ -->
            <div class="step">
            <div class="left">
                <div class="name">6ì‹œê°„ê¶Œ</div>
            </div>
            <div class="ctrl">
                ëŒ€ì¸
                <button class="btn mini" data-step="q_lift6_adult" data-delta="-1">âˆ’</button>
                <div class="count" id="q_lift6_adult">0</div>
                <button class="btn mini" data-step="q_lift6_adult" data-delta="1">+</button>

                ì†Œì¸
                <button class="btn mini" data-step="q_lift6_child" data-delta="-1">âˆ’</button>
                <div class="count" id="q_lift6_child">0</div>
                <button class="btn mini" data-step="q_lift6_child" data-delta="1">+</button>
            </div>
        </div>      

        <div style="height:16px"></div>
        <h2>3) ì¥ë¹„ / ì˜ë¥˜</h2>

        <div class="row">
          <div class="field">
            <div class="step">
              <div class="left">
                <div class="name">ì¥ë¹„ë Œíƒˆ</div>
                <div class="hint" id="equipmentHint">15,000ì› / 1ì¸</div>
              </div>
              <div class="ctrl">
                <button class="btn mini" data-step="q_equipment" data-delta="-1">âˆ’</button>
                <div class="count" id="q_equipment">0</div>
                <button class="btn mini" data-step="q_equipment" data-delta="1">+</button>
              </div>
            </div>
          </div>

          <div class="field">
            <div class="step">
              <div class="left">
                <div class="name">ìŠ¤í‚¤ì—ì´íŠ¸</div>
                <div class="hint">20,000ì› / 1ì¸ (ì˜µì…˜)</div>
              </div>
              <div class="ctrl">
                <button class="btn mini" data-step="q_skiate" data-delta="-1">âˆ’</button>
                <div class="count" id="q_skiate">0</div>
                <button class="btn mini" data-step="q_skiate" data-delta="1">+</button>
              </div>
            </div>
          </div>
        </div>

        <div style="height:10px"></div>

        <div class="row">
          <div class="field">
            <div class="step">
              <div class="left">
                <div class="name" id="clothHighLabel">ê³ ê¸‰ì˜ë¥˜</div>
                <div class="hint" id="clothHighHint">15,000ì› / 1ì¸</div>
              </div>
              <div class="ctrl">
                <button class="btn mini" data-step="q_clothHigh" data-delta="-1">âˆ’</button>
                <div class="count" id="q_clothHigh">0</div>
                <button class="btn mini" data-step="q_clothHigh" data-delta="1">+</button>
              </div>
            </div>
          </div>

          <div class="field">
            <div class="step">
              <div class="left">
                <div class="name">í”„ë¦¬ë¯¸ì—„ì˜ë¥˜</div>
                <div class="hint" id="clothPremiumHint">20,000ì› / 1ì¸</div>
              </div>
              <div class="ctrl">
                <button class="btn mini" data-step="q_clothPremium" data-delta="-1">âˆ’</button>
                <div class="count" id="q_clothPremium">0</div>
                <button class="btn mini" data-step="q_clothPremium" data-delta="1">+</button>
              </div>
            </div>
          </div>
        </div>

        <div style="height:14px"></div>

        <details>
          <summary>ì¶”ê°€ ì˜µì…˜ (ë³´í˜¸ëŒ€/í—¬ë©§)</summary>
          <div style="height:10px"></div>

          <div class="row">
            <div class="field">
              <div class="step">
                <div class="left">
                  <div class="name">ë³´í˜¸ëŒ€</div>
                  <div class="hint">5,000ì› / 1ì¸</div>
                </div>
                <div class="ctrl">
                  <button class="btn mini" data-step="q_pad" data-delta="-1">âˆ’</button>
                  <div class="count" id="q_pad">0</div>
                  <button class="btn mini" data-step="q_pad" data-delta="1">+</button>
                </div>
              </div>
            </div>

            <div class="field">
              <div class="step">
                <div class="left">
                  <div class="name">í—¬ë©§ ë˜ëŠ” ê³ ê¸€</div>
                  <div class="hint">10,000ì› / 1ì¸</div>
                </div>
                <div class="ctrl">
                  <button class="btn mini" data-step="q_helmet" data-delta="-1">âˆ’</button>
                  <div class="count" id="q_helmet">0</div>
                  <button class="btn mini" data-step="q_helmet" data-delta="1">+</button>
                </div>
              </div>
            </div>
          </div>

          <div style="height:10px"></div>

          <div class="row">
            <div class="field">
              <div class="step">
                <div class="left">
                  <div class="name">í—¬ë©§ + ê³ ê¸€</div>
                  <div class="hint">15,000ì› / 1ì¸</div>
                </div>
                <div class="ctrl">
                  <button class="btn mini" data-step="q_helmetSet" data-delta="-1">âˆ’</button>
                  <div class="count" id="q_helmetSet">0</div>
                  <button class="btn mini" data-step="q_helmetSet" data-delta="1">+</button>
                </div>
              </div>
            </div>
          </div>

          <div style="height:10px"></div>

          <div class="row" id="glovesRow" style="display:none;">
          <div class="field">
            <div class="step">
            <div class="left">
                <div class="name">ì¥ê°‘ ëŒ€ì—¬</div>
                <div class="hint">5,000ì› / 1ì¸</div>
            </div>
            <div class="ctrl">
                <button class="btn mini" data-step="q_gloves" data-delta="-1">âˆ’</button>
                <div class="count" id="q_gloves">0</div>
                <button class="btn mini" data-step="q_gloves" data-delta="1">+</button>
            </div>
            </div>
          </div>
          </div>
 

          <div style="height:10px"></div>
          <div class="note">ì˜µì…˜ì€ ì „ë¶€ ì„ íƒì‚¬í•­ì´ë©° 0ëª…ë„ ê°€ëŠ¥í•©ë‹ˆë‹¤. ë³€ê²½ ì¦‰ì‹œ ì´ì•¡ì´ ë°˜ì˜ë©ë‹ˆë‹¤.</div>
        </details>
        <div style="height:16px"></div>
        <h2>4) ê°•ìŠµ</h2>
  
        <div class="step">
          <div class="left">
            <div class="name">ê°•ìŠµ íŒ€ ìˆ˜</div>
            <div class="hint">1íŒ€ = 170,000ì› (ì£¼ì¤‘/ì£¼ë§ ë™ì¼)</div>
          </div>
          <div class="ctrl">
            <button class="btn mini" data-step="q_lessonTeam" data-delta="-1">âˆ’</button>
            <div class="count" id="q_lessonTeam">0</div>
            <button class="btn mini" data-step="q_lessonTeam" data-delta="1">+</button>
          </div>
          <div id="lessonTeamsWrap" style="margin-top:10px;"></div>

        </div>

        <div style="height:16px"></div>
        <h2>5) ë©”ëª¨</h2>
        <div class="field">
        <textarea id="q_memo" placeholder="ì˜ˆ: í”½ì—… ë¬¸ì˜ / ì‚¬ì´ì¦ˆ / ê²°ì œ ë°©ì‹ / ìš”ì²­ì‚¬í•­"></textarea>
        </div>

        <h2>ì˜ˆì•½ ë§í¬</h2>

        <label style="display:flex; align-items:center; gap:8px;">
          <input type="checkbox" id="q_showReserveLink" />
          ê²¬ì ì— ì˜ˆì•½ ë§í¬ í¬í•¨
        </label>

        <div style="height:14px"></div>

        <div class="row">
          <button class="btn primary" id="btnCopyQuote">ê²¬ì  ë³µì‚¬</button>
          <button class="btn danger" id="btnResetQuote">ì´ˆê¸°í™”</button>
        </div>

        <div style="height:10px"></div>
        <div id="q_warn" class="warn"></div>
      </div>

      <div class="stickyTotal">
        <div class="totalBox">
          <div class="totalLabel">ì´ ê²¬ì  ê¸ˆì•¡</div>
          <div class="totalValue" id="q_totalPrice">â‚© 0</div>
          <div class="note" id="q_totalNote">ì´ìš©ì¼ì„ ì„ íƒí•˜ë©´ ì£¼ì¤‘/ì£¼ë§ì´ ìë™ ì ìš©ë©ë‹ˆë‹¤.</div>
        </div>
        <button class="btn" id="btnCoupon10" style="margin-bottom:8px;">
          ì¥ë¹„Â·ì˜ë¥˜ 10% ì¿ í° ì ìš© OFF
        </button>

        <select id="couponSelect" class="btn" style="width:100%;">
        <option value="10" selected>10% í• ì¸</option>
        <option value="15">15% í• ì¸</option>
        <option value="20">20% í• ì¸</option>
        <option value="25">25% í• ì¸</option>
        <option value="30">30% í• ì¸</option>
        <option value="35">35% í• ì¸</option>
        <option value="custom">ì§ì ‘ ì…ë ¥</option>
        </select>

        <input
        type="number"
        id="couponInput"
        class="btn"
        style="width:100%; display:none; margin-top:6px;"
        min="1"
        max="50"
        step="1"
        placeholder="í• ì¸ìœ¨ ì§ì ‘ ì…ë ¥ (%)"
        />

        <details open>
          <summary>ìƒì„¸ë‚´ì—­</summary>
          <div class="breakdown" id="q_breakdown">(ì„ íƒëœ í•­ëª©ì´ ì—†ìŠµë‹ˆë‹¤)</div>
        </details>

        <details>
          <summary>ê°€ê²©í‘œ ìš”ì•½</summary>
          <div class="breakdown" id="q_priceRef"></div>
        </details>
      </div>
    </section>

    <!-- ì˜ˆì•½ì •ë³´ -->
    <section id="viewReserve" class="grid" style="display:none;">
      <div class="card">
        <h2>1) ì˜ˆì•½ì •ë³´ ì…ë ¥</h2>

        <div class="row">
          <div class="field">
            <label>ì„±í•¨</label>
            <input type="text" id="r_name" placeholder="ì˜ˆ: í™ê¸¸ë™" />
          </div>
          <div class="field">
            <label>ì—°ë½ì²˜</label>
            <input type="tel" id="r_phone" placeholder="010-0000-0000" />
          </div>
        </div>

        <div style="height:10px"></div>

        <div class="row">
          <div class="field">
            <label>ì´ìš©ì˜ˆì •ì¼ (ë‹¬ë ¥ ì„ íƒ)</label>
            <input type="date" id="r_date" />
          </div>
          <div class="field">
            <label>í‘œì‹œ</label>
            <input type="text" id="r_dateLabel" placeholder="YYYY-MM-DD (ìš”ì¼ Â· ì£¼ì¤‘/ì£¼ë§)" readonly />
          </div>
        </div>

        <div style="height:10px"></div>

        <div class="row">
          <div class="field">
            <label>ë°©ë¬¸ì˜ˆì • ì‹œê°„</label>
            <select id="r_time">
                <option value="">ì‹œê°„ ì„ íƒ</option>
                <option value="08:00">08:00</option>
                <option value="09:00">09:00</option>
                <option value="10:00">10:00</option>
                <option value="11:00">11:00</option>
                <option value="12:00">12:00</option>
                <option value="13:00">13:00</option>
                <option value="14:00">14:00</option>
                <option value="15:00">15:00</option>
                <option value="16:00">16:00</option>
                <option value="17:00">17:00</option>
                <option value="18:00">18:00</option>
                <option value="19:00">19:00</option>
                <option value="20:00">20:00</option>
                <option value="21:00">21:00</option>
                <option value="22:00">22:00</option>
            </select>
          </div>
          <div class="field" style="min-width:200px;">
            <label>ì‹œê°„ ë¯¸ì •</label>
            <div class="seg">
              <label><input type="checkbox" id="r_timeUnknown"> ë¯¸ì •</label>
            </div>
          </div>
        </div>

        <div style="height:10px"></div>

        <div class="field">
          <label>ë¦¬í”„íŠ¸ê¶Œ ì‹œê°„</label>
          <div class="seg" id="r_liftSeg">
            <label><input type="radio" name="r_lift" value="none" checked> ì—†ìŒ</label>
            <label><input type="radio" name="r_lift" value="3"> 3ì‹œê°„ê¶Œ</label>
            <label><input type="radio" name="r_lift" value="4"> 4ì‹œê°„ê¶Œ</label>
            <label><input type="radio" name="r_lift" value="6"> 6ì‹œê°„ê¶Œ</label>
            <label><input type="radio" name="r_lift" value="unknown"> ë¯¸ì •</label>
          </div>
        </div>

        <div style="height:14px"></div>

        <h2>2) ì¸ì› / ë Œíƒˆ</h2>
        <div class="row">
          <div class="field">
            <div class="step">
              <div class="left">
                <div class="name">ëŒ€ì¸</div>
                <div class="hint">ì˜ˆì•½ ì¸ì›</div>
              </div>
              <div class="ctrl">
                <button class="btn mini" data-step="r_adult" data-delta="-1">âˆ’</button>
                <div class="count" id="r_adult">0</div>
                <button class="btn mini" data-step="r_adult" data-delta="1">+</button>
              </div>
            </div>
          </div>

          <div class="field">
            <div class="step">
              <div class="left">
                <div class="name">ì†Œì¸</div>
                <div class="hint">ì˜ˆì•½ ì¸ì›</div>
              </div>
              <div class="ctrl">
                <button class="btn mini" data-step="r_child" data-delta="-1">âˆ’</button>
                <div class="count" id="r_child">0</div>
                <button class="btn mini" data-step="r_child" data-delta="1">+</button>
              </div>
            </div>
          </div>
        </div>

        <div style="height:12px"></div>
        <div class="pill">ë¦¬í”„íŠ¸ê¶Œ ì¸ì›: <b id="r_totalPeople">0</b>ëª…</div>

        <div style="height:12px"></div>

        <div class="row">
          <div class="field">
            <div class="step">
              <div class="left">
                <div class="name">ë Œíƒˆ ì¸ì›</div>
                <div class="hint">ì¥ë¹„/ì˜ë¥˜ í•©ì‚°(ì›í•˜ë©´)</div>
              </div>
              <div class="ctrl">
                <button class="btn mini" data-step="r_rental" data-delta="-1">âˆ’</button>
                <div class="count" id="r_rental">0</div>
                <button class="btn mini" data-step="r_rental" data-delta="1">+</button>
              </div>
            </div>
          </div>
        </div>

        <div style="height:14px"></div>
        <h2>3) ë©”ëª¨</h2>
        <div class="field">
          <textarea id="r_memo" placeholder="ì˜ˆ: í”½ì—… ë¬¸ì˜ / ì‚¬ì´ì¦ˆ / ê²°ì œ ë°©ì‹ / ìš”ì²­ì‚¬í•­"></textarea>
        </div>

        <div style="height:14px"></div>
        <div class="row">
          <button class="btn primary" id="btnCopyReserve">ì •ë¦¬ë³¸ ë³µì‚¬</button>
          <button class="btn" id="btnCopyReserveWithQuote">ì •ë¦¬ë³¸+ê²¬ì  ê°™ì´ ë³µì‚¬</button>
          <button class="btn danger" id="btnResetReserve">ì´ˆê¸°í™”</button>
        </div>
      </div>

      <div class="stickyTotal">
        <div class="totalBox">
          <div class="totalLabel">ì˜ˆì•½ì •ë³´ ì •ë¦¬ë³¸</div>
          <div class="note">ë³µì‚¬ ë²„íŠ¼ì„ ëˆ„ë¥´ë©´ ì•„ë˜ ë‚´ìš©ì´ í´ë¦½ë³´ë“œì— ì €ì¥ë©ë‹ˆë‹¤.</div>
        </div>

        <div class="card">
          <textarea class="outBox" id="r_output" readonly></textarea>
        </div>

        <div class="note">Tip) ê²¬ì  í™”ë©´ì—ì„œ â€œì˜ˆì•½ìœ¼ë¡œ ë„˜ê¸°ê¸°â€ê°€ í•„ìš”í•˜ë©´, ì´í›„ ë²„íŠ¼ í•˜ë‚˜ë¡œ ìë™ ì±„ì›€ë„ ì‰½ê²Œ ì¶”ê°€ë©ë‹ˆë‹¤.</div>
      </div>
    </section>
  </div>

  <div class="toast" id="toast">ë³µì‚¬ ì™„ë£Œ</div>

  <script>
    // -------------------------
    // ê°€ê²©í‘œ
    // -------------------------
    const PRICES = {
        common: {
            equipment: 15000,
            skiate: 20000,
            pad: 5000,
            helmet: 10000,
            helmetSet: 15000,
            gloves: 5000,
            lift: {
            weekday: {
                "3": { adult: 44000, child: 35000 },
                "4": { adult: 51000, child: 41000 },
                "6": { adult: 58000, child: 47000 },
            },
            weekend: {
                "3": { adult: 54000, child: 43000 },
                "4": { adult: 61000, child: 49000 },
                "6": { adult: 69000, child: 55000 },
            }
            }
        },
        shops: {
            choice: { // ì´ˆì´ìŠ¤
            clothTypeLabel: "ê³ ê¸‰ì˜ë¥˜",
            clothHigh: { weekday: 15000, weekend: 15000 },
            clothPremium: { weekday: 20000, weekend: 20000 },
            },
            sky: { // ìŠ¤ì¹´ì´
            clothTypeLabel: "ì‹ ìƒì˜ë¥˜",
            clothHigh: { weekday: 20000, weekend: 25000 },
            clothPremium: { weekday: 25000, weekend: 30000 },
            },
            national: { // êµ­ëŒ€(ìŠ¤ì¹´ì´ì™€ ë™ì¼)
            clothTypeLabel: "ì‹ ìƒì˜ë¥˜",
            clothHigh: { weekday: 20000, weekend: 25000 },
            clothPremium: { weekday: 25000, weekend: 30000 },
            }
        }
    };
    const SHOP_GREETING = {
        choice: "ì•ˆë…•í•˜ì„¸ìš” ì´ˆì´ìŠ¤ìŠ¤í‚¤ìƒµì…ë‹ˆë‹¤.",
        sky: "ì•ˆë…•í•˜ì„¸ìš” ìŠ¤ì¹´ì´ìŠ¤í‚¤ìƒµì…ë‹ˆë‹¤.",
        national: "ì•ˆë…•í•˜ì„¸ìš” êµ­ê°€ëŒ€í‘œìŠ¤í‚¤ìƒµì…ë‹ˆë‹¤."
    };


    // -------------------------
    // ìœ í‹¸
    // -------------------------
    const $ = (id) => document.getElementById(id);
    const fmt = (n) => "â‚© " + Number(n || 0).toLocaleString("ko-KR");
    const toast = (msg="ì™„ë£Œ") => {
      const t = $("toast");
      t.textContent = msg;
      t.style.display = "block";
      clearTimeout(window.__toastTimer);
      window.__toastTimer = setTimeout(()=> t.style.display="none", 1200);
    };
    const WEEKEND_PRICE_DATES = new Set([
    "2025-12-25", // í¬ë¦¬ìŠ¤ë§ˆìŠ¤ ì˜ˆì‹œ
    "2026-01-01", // ì‹ ì • ì˜ˆì‹œ
    "2026-02-16",
    "2026-02-17",
    "2026-02-18"
    // ì›í•˜ëŠ” ë‚ ì§œ ê³„ì† ì¶”ê°€
    ]);



    function getDayTypeFromDate(isoDate) {
    if (!isoDate) return null;

    // âœ… ë¸Œë¼ìš°ì € íŒŒì‹±(UTC) ì´ìŠˆ ë°©ì§€: ë¡œì»¬ Date ìƒì„±
    const [yy, mm, dd] = isoDate.split("-").map(Number);
    const d = new Date(yy, mm - 1, dd); // ë¡œì»¬ ê¸°ì¤€
    const day = d.getDay(); // 0 Sun .. 6 Sat

    const weekdayNames = ["ì¼","ì›”","í™”","ìˆ˜","ëª©","ê¸ˆ","í† "];

    // í† /ì¼ OR ì§€ì •í•œ ë‚ ì§œë©´ ì£¼ë§ ìš”ê¸ˆ
    const isWeekend = (day === 0 || day === 6) || WEEKEND_PRICE_DATES.has(isoDate);

    return {
        dayType: isWeekend ? "weekend" : "weekday",
        label: isWeekend ? "ì£¼ë§" : "ì£¼ì¤‘",
        dow: weekdayNames[day],
        iso: isoDate
    };
    }

    function clamp(v, min, max) {
      return Math.max(min, Math.min(max, v));
    }

    function readCount(id) {
      return Number($(id).textContent || 0);
    }
    function setCount(id, val) {
      $(id).textContent = String(val);
    }
    const lessonState = {};
    function renderLessonTeams() {
        const wrap = document.getElementById("lessonTeamsWrap");
        if (!wrap) return;

        const teamCount = readCount("q_lessonTeam");

        // âœ… í˜„ì¬ DOMì— ìˆëŠ” ê°’ë“¤ ë¨¼ì € ì €ì¥
        for (let i = 1; i <= teamCount; i++) {
            const cntEl = document.getElementById(`q_lesson_${i}_cnt`);
            const timeEl = document.getElementById(`q_lesson_${i}_time`);
            const typeEl = document.querySelector(`input[name="q_lesson_${i}_type"]:checked`);
            if (cntEl) {
            lessonState[i] = {
                cnt: Number(cntEl.textContent || 1),
                time: timeEl?.value || "ì˜¤ì „",
                type: typeEl?.value || "ski",
            };
            }
        }

        wrap.innerHTML = "";

        for (let i = 1; i <= teamCount; i++) {
            const saved = lessonState[i] || { cnt: 1, time: "ì˜¤ì „", type: "ski" };

            const row = document.createElement("div");
            row.className = "step";
            row.style.marginTop = "8px";

            row.innerHTML = `
                <div class="left">
                    <div class="name">ê°•ìŠµ ${i}íŒ€</div>
                    <div class="hint">ì¸ì› / ì‹œê°„ / ì¢…ëª© ì„ íƒ</div>
                </div>

                <div class="ctrl" style="flex-wrap:wrap; gap:8px;">
                    ì¸ì›
                    <button class="btn mini" data-step="q_lesson_${i}_cnt" data-delta="-1">âˆ’</button>
                    <div class="count" id="q_lesson_${i}_cnt">${saved.cnt}</div>
                    <button class="btn mini" data-step="q_lesson_${i}_cnt" data-delta="1">+</button>

                    <select id="q_lesson_${i}_time" class="btn" style="padding:8px 10px;">
                        <option value="ì˜¤ì „" ${saved.time==="ì˜¤ì „"?"selected":""}>ì˜¤ì „(09:00)</option>
                        <option value="ì˜¤í›„" ${saved.time==="ì˜¤í›„"?"selected":""}>ì˜¤í›„(13:00)</option>
                        <option value="ì•¼ê°„" ${saved.time==="ì•¼ê°„"?"selected":""}>ì•¼ê°„(19:00)</option>
                    </select>

                    <label style="display:flex; align-items:center; gap:6px; margin-left:6px;">
                        <input type="radio" name="q_lesson_${i}_type" value="ski" ${saved.type==="ski"?"checked":""}> ìŠ¤í‚¤
                    </label>
                    <label style="display:flex; align-items:center; gap:6px;">
                        <input type="radio" name="q_lesson_${i}_type" value="board" ${saved.type==="board"?"checked":""}> ë³´ë“œ
                    </label>
                </div>
            `;

            wrap.appendChild(row);
        }
    }


    document.addEventListener("change", (e) => {
        if (
            e.target.matches('input[name^="q_lesson_"][name$="_type"]') ||
            e.target.id.startsWith("q_lesson_") && e.target.id.endsWith("_time")
        ) {
            updateQuote();
        }
    });




    couponDiscountRate = Number($("couponSelect").value || 10); // ê¸°ë³¸ 10% ì„ íƒê°’ ìœ ì§€
    couponApplied = false; // âœ… ì´ˆê¸° OFF

    function refreshCouponUI() {
        const btn = $("btnCoupon10");

        if (couponApplied && couponDiscountRate > 0) {
            btn.textContent = `ì¥ë¹„Â·ì˜ë¥˜ ${couponDiscountRate}% ì¿ í° ì ìš© ON`;
        } else {
            btn.textContent = "ì¥ë¹„Â·ì˜ë¥˜ ì¿ í° ì ìš© OFF";
        }
    }

    refreshCouponUI();
    $("couponInput").style.display = "none";
    $("couponInput").value = "";


    // -------------------------
    // íƒ­ ì „í™˜
    // -------------------------
    const tabQuote = $("tabQuote");
    const tabReserve = $("tabReserve");
    const viewQuote = $("viewQuote");
    const viewReserve = $("viewReserve");

    tabQuote.addEventListener("click", () => {
      tabQuote.classList.add("active");
      tabReserve.classList.remove("active");
      viewQuote.style.display = "";
      viewReserve.style.display = "none";
      syncDayTypePill();
    });

    tabReserve.addEventListener("click", () => {
      tabReserve.classList.add("active");
      tabQuote.classList.remove("active");
      viewReserve.style.display = "";
      viewQuote.style.display = "none";
      syncDayTypePill();
      updateReserveOutput();
    });

    function syncDayTypePill() {
      // í˜„ì¬ ë³´ì´ëŠ” í™”ë©´ì˜ ë‚ ì§œ ê¸°ì¤€ìœ¼ë¡œ ìƒë‹¨ pill í‘œì‹œ
      const isQuote = viewQuote.style.display !== "none";
      const iso = isQuote ? $("q_date").value : $("r_date").value;
      const info = getDayTypeFromDate(iso);
      const pill = $("dayTypePill");
      if (!info) {
        pill.textContent = "ì´ìš©ì¼ ë¯¸ì„ íƒ";
        return;
      }
      pill.textContent = `${info.iso} (${info.dow} Â· ${info.label})`;
    }

    // -------------------------
    // Stepper ê³µí†µ í•¸ë“¤ëŸ¬
    // -------------------------
    document.addEventListener("click", (e) => {
      const btn = e.target.closest("button[data-step]");
      if (!btn) return;
      const id = btn.getAttribute("data-step");
      const delta = Number(btn.getAttribute("data-delta"));
      const isQuote = id.startsWith("q_");
      const max = 99;

      const cur = readCount(id);
      let next = clamp(cur + delta, 0, max);
      if (id.startsWith("q_lesson_") && id.endsWith("_cnt")) {
        next = clamp(cur + delta, 1, max);
      }
      setCount(id, next);
      if (id === "q_lessonTeam") renderLessonTeams();


      if (isQuote) {
        enforceQuoteRules();
        updateQuote();
      } else {
        enforceReserveRules();
        updateReserveOutput();
      }
    });

    // -------------------------
    // ê²¬ì  í™”ë©´ ë¡œì§
    // -------------------------
    $("q_date").addEventListener("change", () => {
      const info = getDayTypeFromDate($("q_date").value);
      $("q_dateLabel").value = info ? `${info.iso} (${info.dow} Â· ${info.label})` : "";
      syncDayTypePill();
      syncClothLabel();
      updateQuote();
    });

    document.querySelectorAll('input[name="q_lift"]').forEach(r => {
      r.addEventListener("change", updateQuote);
    });

    function quoteTotals() {
      const lift3Adult = readCount("q_lift3_adult");
      const lift3Child = readCount("q_lift3_child");
      const lift4Adult = readCount("q_lift4_adult");
      const lift4Child = readCount("q_lift4_child");
      const lift6Adult = readCount("q_lift6_adult");
      const lift6Child = readCount("q_lift6_child");
      const totalPeople = lift3Adult + lift3Child + lift4Adult + lift4Child + lift6Adult + lift6Child;

      const dateInfo = getDayTypeFromDate($("q_date").value);
      const dayType = dateInfo ? dateInfo.dayType : "weekday"; // ë‚ ì§œ ì—†ìœ¼ë©´ ì„ì‹œ ì£¼ì¤‘ ê¸°ì¤€
      const shop = document.querySelector('input[name="shop"]:checked')?.value || "choice";
      const S = PRICES.shops[shop];
      const equipmentUnit = (shop === "sky" || shop === "national") ? 20000 : PRICES.common.equipment;
      const C = PRICES.common;

      // ë Œíƒˆ/ì˜µì…˜
      const equipment = readCount("q_equipment");
      const skiate = readCount("q_skiate");
      const clothHigh = readCount("q_clothHigh");
      const clothPremium = readCount("q_clothPremium");
      const gloves = readCount("q_gloves");
      const pad = readCount("q_pad");
      const helmet = readCount("q_helmet");
      const helmetSet = readCount("q_helmetSet");

      // ë¦¬í”„íŠ¸
      let liftTotal = 0;
        const items = [];

        // 3ì‹œê°„ê¶Œ
        if (lift3Adult + lift3Child > 0) {
        const p = C.lift[dayType]["3"];
        const amt = p.adult * lift3Adult + p.child * lift3Child;
        liftTotal += amt;
        items.push({
            key: "lift3",
            label: `ë¦¬í”„íŠ¸ê¶Œ(3ì‹œê°„ Â· ${dayType === "weekend" ? "ì£¼ë§" : "ì£¼ì¤‘"})`,
            amount: amt,
            original: amt,
            detail:
            `- ëŒ€ì¸ ${p.adult.toLocaleString()}ì› Ã— ${lift3Adult}\n` +
            `- ì†Œì¸ ${p.child.toLocaleString()}ì› Ã— ${lift3Child}`
        });
        }

        // 4ì‹œê°„ê¶Œ
        if (lift4Adult + lift4Child > 0) {
        const p = C.lift[dayType]["4"];
        const amt = p.adult * lift4Adult + p.child * lift4Child;
        liftTotal += amt;
        items.push({
            key: "lift4",
            label: `ë¦¬í”„íŠ¸ê¶Œ(4ì‹œê°„ Â· ${dayType === "weekend" ? "ì£¼ë§" : "ì£¼ì¤‘"})`,
            amount: amt,
            original: amt,
            detail:
            `- ëŒ€ì¸ ${p.adult.toLocaleString()}ì› Ã— ${lift4Adult}\n` +
            `- ì†Œì¸ ${p.child.toLocaleString()}ì› Ã— ${lift4Child}`
        });
        }

        // 6ì‹œê°„ê¶Œ
        if (lift6Adult + lift6Child > 0) {
        const p = C.lift[dayType]["6"];
        const amt = p.adult * lift6Adult + p.child * lift6Child;
        liftTotal += amt;
        items.push({
            key: "lift6",
            label: `ë¦¬í”„íŠ¸ê¶Œ(6ì‹œê°„ Â· ${dayType === "weekend" ? "ì£¼ë§" : "ì£¼ì¤‘"})`,
            amount: amt,
            original: amt,
            detail:
            `- ëŒ€ì¸ ${p.adult.toLocaleString()}ì› Ã— ${lift6Adult}\n` +
            `- ì†Œì¸ ${p.child.toLocaleString()}ì› Ã— ${lift6Child}`
        });
        }
      const DISCOUNT_TARGETS = ["ì¥ë¹„ë Œíƒˆ", "ê³ ê¸‰ì˜ë¥˜", "ì‹ ìƒì˜ë¥˜", "í”„ë¦¬ë¯¸ì—„ì˜ë¥˜","ìŠ¤í‚¤ì—ì´íŠ¸"];
      const addLine = (label, unit, qty) => {
        if (qty <= 0) return;

        const original = unit * qty;
        let amount = original;
        let detailLines = [];

        // ì›ê°€
        detailLines.push(`- ì›ê°€ ${unit.toLocaleString()}ì›`);
        detailLines.push(`${unit.toLocaleString()}ì› Ã— ${qty}`);

        // ì¿ í° ì ìš© ëŒ€ìƒ
// ì¿ í° ì ìš© ëŒ€ìƒ
        if (couponApplied && DISCOUNT_TARGETS.includes(label) && couponDiscountRate > 0) {

            const discount = Math.floor(original * couponDiscountRate / 100);
            amount = original - discount;

            detailLines.push(`â†’ í• ì¸ìœ¨ ${couponDiscountRate}% ì ìš©`);
            detailLines.push(`â†’ í• ì¸ ê¸ˆì•¡ ${discount.toLocaleString()}ì›`);
            detailLines.push(`â†’ ì¿ í° ì ìš©ê°€ ${amount.toLocaleString()}ì›`);
            detailLines.push(`${amount.toLocaleString()} x ${qty}`);
        }



        items.push({
            key: label,
            label,
            amount,
            original,
            detail: detailLines.join("\n")
        });
      };


      addLine("ì¥ë¹„ë Œíƒˆ", equipmentUnit, equipment);
      addLine("ìŠ¤í‚¤ì—ì´íŠ¸", C.skiate, skiate);
      addLine(S.clothTypeLabel, S.clothHigh[dayType], clothHigh);
      addLine("í”„ë¦¬ë¯¸ì—„ì˜ë¥˜", S.clothPremium[dayType], clothPremium);
      addLine("ë³´í˜¸ëŒ€", C.pad, pad);
      addLine("í—¬ë©§ ë˜ëŠ” ê³ ê¸€", C.helmet, helmet);
      addLine("í—¬ë©§+ê³ ê¸€", C.helmetSet, helmetSet);
      if (shop === "choice") {
        addLine("ì¥ê°‘ ëŒ€ì—¬", C.gloves, gloves);
      }
    const lessonTeams = readCount("q_lessonTeam");
    if (lessonTeams > 0) {
        const lessonPrice = lessonTeams * 170000;

        // íŒ€ë³„ ìƒì„¸(ì¸ì›/ì¢…ëª©) ë¬¸ìì—´ ë§Œë“¤ê¸°
        const teamLines = [];
        for (let i = 1; i <= lessonTeams; i++) {
            const cnt = readCount(`q_lesson_${i}_cnt`);
            const type = document.querySelector(`input[name="q_lesson_${i}_type"]:checked`)?.value || "ski";
            const time = document.getElementById(`q_lesson_${i}_time`)?.value || "ì˜¤ì „";

            const typeKr = (type === "ski") ? "ìŠ¤í‚¤" : "ë³´ë“œ";

            // âœ… ë„¤ê°€ ì›í•˜ëŠ” ì¶œë ¥: "1:N ì˜¤ì „ìŠ¤í‚¤"
            teamLines.push(`Â· ${i}. 1:${cnt} ${time}${typeKr}`);
        }

        items.push({
            key: "lesson",
            label: `ê°•ìŠµ (${lessonTeams}íŒ€)`,
            amount: lessonPrice,
            original: lessonPrice,
            detail:
            `- 170,000ì› Ã— ${lessonTeams}\n` +
            teamLines.join("\n")
        });
    }

    // âœ… totalì€ items ë‹¤ ë„£ê³  ë‚œ ë’¤ì— ê³„ì‚°í•´ì•¼ í•¨
    const total = items.reduce((s, x) => s + x.amount, 0);

      return {
        totalPeople,
        dayType, dateInfo,
        lift3Adult, lift3Child, lift4Adult, lift4Child, lift6Adult, lift6Child,
        equipment, skiate, clothHigh, clothPremium, pad, helmet, helmetSet,
        items, total
      };
    }

    function enforceQuoteRules() {
        const lift3Adult = readCount("q_lift3_adult");
        const lift3Child = readCount("q_lift3_child");
        const lift4Adult = readCount("q_lift4_adult");
        const lift4Child = readCount("q_lift4_child");
        const lift6Adult = readCount("q_lift6_adult");
        const lift6Child = readCount("q_lift6_child");
        const totalPeople = lift3Adult + lift3Child + lift4Adult + lift4Child + lift6Adult + lift6Child;
        

      // ì´ì¸ì› í‘œì‹œ
      $("q_totalPeople").textContent = String(totalPeople);

      // ì¥ë¹„/ì˜ë¥˜/ì˜µì…˜ì€ ë¦¬í”„íŠ¸ ì¸ì›ê³¼ ë¬´ê´€
      const rentalTotal =
      readCount("q_equipment") +
      readCount("q_skiate") +
      readCount("q_clothHigh") +
      readCount("q_clothPremium");
 
      // ì¥ë¹„ ì¤‘ë³µ ë°©ì§€ (ì¥ë¹„ + ìŠ¤í‚¤ì—ì´íŠ¸)
      let eq = readCount("q_equipment");
      let sk = readCount("q_skiate");
      if (eq + sk > rentalTotal) {
        setCount("q_skiate", Math.max(0, rentalTotal - eq));
      }

      // ì˜ë¥˜ ì¤‘ë³µ ë°©ì§€ (ê³ ê¸‰ + í”„ë¦¬ë¯¸ì—„)
      let ch = readCount("q_clothHigh");
      let cp = readCount("q_clothPremium");
      if (ch + cp > rentalTotal) {
       setCount("q_clothPremium", Math.max(0, rentalTotal - ch));
      }

      // í—¬ë©§ ì¤‘ë³µ ë°©ì§€
      let h = readCount("q_helmet");
      let hs = readCount("q_helmetSet");
      if (h + hs > rentalTotal) {
       setCount("q_helmetSet", Math.max(0, rentalTotal - h));
      }
  
      // ê²½ê³  ë¬¸êµ¬
      const warns = [];
      if (!$("q_date").value) warns.push("ì´ìš©ì¼ì„ ì„ íƒí•˜ë©´ ì£¼ì¤‘/ì£¼ë§ ìš”ê¸ˆì´ ìë™ ì ìš©ë©ë‹ˆë‹¤. (í˜„ì¬ëŠ” ì£¼ì¤‘ ê¸°ì¤€ìœ¼ë¡œ ì„ì‹œ ê³„ì‚°)");
      if (totalPeople === 0 && (readCount("q_equipment")+readCount("q_skiate")+readCount("q_clothHigh")+readCount("q_clothPremium")+readCount("q_pad")+readCount("q_helmet")+readCount("q_helmetSet")) > 0) {
        warns.push("ì´ ì¸ì›ì´ 0ëª…ì´ë¼ ì˜µì…˜ ì¸ì›ì´ ìë™ìœ¼ë¡œ 0ìœ¼ë¡œ ë§ì¶°ì¡ŒìŠµë‹ˆë‹¤.");
      }
      $("q_warn").textContent = warns.join("\n");
    }

    function renderFaqFields() {
      const wrap = document.getElementById("faqWrap");
      const countEl = document.getElementById("q_faqCount");
      if (!wrap || !countEl) return;

      const n = Number(countEl.value || 0);

      // ê¸°ì¡´ ì…ë ¥ê°’ ìœ ì§€
      const prev = [];
      for (let i = 1; i <= 20; i++) {
        const q = document.getElementById(`q_faq_q_${i}`)?.value || "";
        const a = document.getElementById(`q_faq_a_${i}`)?.value || "";
        prev.push({ q, a });
      }

      wrap.innerHTML = "";

      for (let i = 1; i <= n; i++) {
        const item = document.createElement("div");
        item.className = "card";
        item.style.padding = "12px";
        item.style.marginTop = "10px";

        const saved = prev[i - 1] || { q: "", a: "" };

        item.innerHTML = `
          <div class="row">
            <div class="field" style="min-width:240px;">
              <label>ê¸°íƒ€ì‚¬í•­ ${i} - ê³ ê° ì§ˆë¬¸</label>
              <textarea id="q_faq_q_${i}" placeholder="ì˜ˆ: ì†Œì¸ ì¥ë¹„ë„ ì„±ì¸ê³¼ ë™ì¼ êµ¬ì„±ì¸ê°€ìš”?">${saved.q}</textarea>
            </div>
            <div class="field" style="min-width:240px;">
              <label>ê¸°íƒ€ì‚¬í•­ ${i} - ë‹µë³€</label>
              <textarea id="q_faq_a_${i}" placeholder="ì˜ˆ: ë„¤, ë™ì¼ êµ¬ì„±ìœ¼ë¡œ ì¤€ë¹„ë˜ë©° í‚¤/ë°œì‚¬ì´ì¦ˆ ê¸°ì¤€ìœ¼ë¡œ ë§ì¶°ë“œë¦½ë‹ˆë‹¤.">${saved.a}</textarea>
            </div>
          </div>
        `;
        wrap.appendChild(item);
      }

      // ì…ë ¥ ë³€í™” ì‹œ ê²¬ì  í…ìŠ¤íŠ¸ ê°±ì‹ 
      wrap.querySelectorAll("textarea").forEach(el => {
        el.addEventListener("input", updateQuote);
      });

      updateQuote();
    }

    function updateQuote() {
      enforceQuoteRules();
      const t = quoteTotals();
      const shop = document.querySelector('input[name="shop"]:checked')?.value || "choice";

      $("q_totalPrice").textContent = fmt(t.total);
      $("q_totalPeople").textContent = String(t.totalPeople);

      // note
      if (t.dateInfo) {
        $("q_totalNote").textContent = `${t.dateInfo.iso} (${t.dateInfo.dow} Â· ${t.dateInfo.label}) ê¸°ì¤€ìœ¼ë¡œ ê³„ì‚°ë©ë‹ˆë‹¤.`;
      } else {
        $("q_totalNote").textContent = "ì´ìš©ì¼ì„ ì„ íƒí•˜ë©´ ì£¼ì¤‘/ì£¼ë§ì´ ìë™ ì ìš©ë©ë‹ˆë‹¤. (í˜„ì¬ëŠ” ì£¼ì¤‘ ê¸°ì¤€ ì„ì‹œ ê³„ì‚°)";
      }

      // breakdown text
      if (t.items.length === 0) {
        $("q_breakdown").textContent = "(ì„ íƒëœ í•­ëª©ì´ ì—†ìŠµë‹ˆë‹¤)";
      } else {
        const lines = [];
        const shop = document.querySelector('input[name="shop"]:checked')?.value || "choice";
        const greeting = SHOP_GREETING[shop] || "";

        if (greeting) {
        lines.push(greeting);
        lines.push(""); // í•œ ì¤„ ë„ìš°ê¸°
        }
        // --- ê¸°íƒ€ì‚¬í•­(Q/A) ì¶œë ¥ (ì…ë ¥ëœ ìŒë§Œ) ---
        const faqPairs = [];
        const faqN = Number(document.getElementById("q_faqCount")?.value || 0);

        for (let i = 1; i <= faqN; i++) {
          const q = (document.getElementById(`q_faq_q_${i}`)?.value || "").trim();
          const a = (document.getElementById(`q_faq_a_${i}`)?.value || "").trim();
          if (q && a) faqPairs.push({ q, a });
        }

        if (faqPairs.length > 0) {
          lines.push("ì‘ì„±í•´ì£¼ì‹  ë¬¸ì˜ì‚¬í•­ì— ëŒ€í•´ ë¨¼ì € ì•ˆë‚´ë“œë¦½ë‹ˆë‹¤.");
          lines.push("");
          lines.push("[Q  &  A]");
          lines.push("");
          for (const p of faqPairs) {
            lines.push(`Q. ${p.q}`);
            lines.push(`A. ${p.a}`);
            lines.push("");
          }
        }

        // --- ê²¬ì  ì „í™˜ ë¬¸êµ¬ ---
        lines.push("ìš”ì²­í•´ì£¼ì‹  ê²¬ì ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.");
        lines.push("");
        lines.push("[ê²¬ì  ì•ˆë‚´]");        

        
        if (t.dateInfo) lines.push(`ì´ìš©ì¼: ${t.dateInfo.iso} (${t.dateInfo.dow} Â· ${t.dateInfo.label})`);
        else lines.push(`ì´ìš©ì¼: ë¯¸ì„ íƒ(ì£¼ì¤‘ ê¸°ì¤€ ì„ì‹œ ê³„ì‚°)`);
        // lines.push( `ë¦¬í”„íŠ¸ ì¸ì›: ` + `3ì‹œê°„(ëŒ€ì¸ ${t.lift3Adult}, ì†Œì¸ ${t.lift3Child}) / ` + `4ì‹œê°„(ëŒ€ì¸ ${t.lift4Adult}, ì†Œì¸ ${t.lift4Child}) / ` + `6ì‹œê°„(ëŒ€ì¸ ${t.lift6Adult}, ì†Œì¸ ${t.lift6Child})` );
        // lines.push(`ë¦¬í”„íŠ¸ê¶Œ ì¸ì›: ${t.totalPeople}ëª…`);

        for (const it of t.items) {
          if (couponApplied && it.original !== it.amount) {
            lines.push(
              `${it.label}: ${it.amount.toLocaleString()}ì› (ì¿ í° ${couponDiscountRate}% ì ìš©)`
            );
            lines.push(
              `- ì›ê°€ ${it.original.toLocaleString()}ì›`
            );
          } else {
            lines.push(
              `${it.label}: ${it.amount.toLocaleString()}ì›`
            );
          }
        
          if (it.detail) lines.push(it.detail);
          lines.push("");
        }

        const memo = $("q_memo")?.value?.trim() || "";

        lines.push(`ì´ ê²¬ì  ê¸ˆì•¡: ${t.total.toLocaleString()}ì›`);
        const showReserve = document.getElementById("q_showReserveLink")?.checked;
        const shopVal = document.querySelector('input[name="shop"]:checked')?.value;

        const RESERVE_LINKS = {
          choice: {
            home: "http://www.kgrc.co.kr/bbs/write.php?bo_table=04_02",
            naver: "https://booking.naver.com/booking/5/bizes/791512/items/4701786",
          },
          sky: {
            home: "https://www.mujusky.co.kr/bbs/write.php?bo_table=06_05",
            naver: "https://booking.naver.com/booking/5/bizes/272888/items/4165761?",
          },
          national: {
            home: "http://okmuju.com/bbs/write.php?bo_table=08",
            naver: "https://booking.naver.com/booking/5/bizes/305178/items/3643073?",
          },
        };


        if (showReserve && shopVal && RESERVE_LINKS[shopVal]) {
          const links = RESERVE_LINKS[shopVal];

          lines.push("");
          lines.push("----------------------------------------------");
          lines.push("ì˜ˆì•½ì€ ì•„ë˜ ë§í¬ì—ì„œ ì§„í–‰ ë¶€íƒë“œë¦½ë‹ˆë‹¤.");
          lines.push("ê°€ê³„ì•½ê¸ˆ 5ë§Œì› ê²°ì œ í›„,");
          lines.push("ì”ì•¡ì€ ì´ìš© ë‹¹ì¼ í˜„ì¥ ê²°ì œì…ë‹ˆë‹¤.");
          lines.push("");

          lines.push("â€» ì˜ˆì•½í•˜ê¸°");
          lines.push(links.home);
          lines.push("");

          lines.push("*Ní˜ì´ ì˜ˆì•½í•˜ê¸°*");
          lines.push(links.naver);
        }
        lines.push("");

        if (memo) {
        lines.push(memo);
        } else {
        lines.push("");
        }

        $("q_breakdown").textContent = lines.join("\n").trim();
      }

      // ê°€ê²©í‘œ ìš”ì•½
      const S = PRICES.shops[shop];

      const dateInfo = getDayTypeFromDate($("q_date").value);
      const dayType = dateInfo ? dateInfo.dayType : "weekday";
      const dayLabel = dayType === "weekend" ? "ì£¼ë§" : "ì£¼ì¤‘";

      const priceRef = [];
      const equipmentUnit = (shop === "sky" || shop === "national") ? 20000 : PRICES.common.equipment;
      priceRef.push( `ì¥ë¹„ ${equipmentUnit.toLocaleString()} / ìŠ¤í‚¤ì—ì´íŠ¸ ${PRICES.common.skiate.toLocaleString()}` );
      priceRef.push(
      `${S.clothTypeLabel} (${dayLabel}) ${S.clothHigh[dayType].toLocaleString()} / ` +
      `í”„ë¦¬ë¯¸ì—„ì˜ë¥˜ (${dayLabel}) ${S.clothPremium[dayType].toLocaleString()}`
      );
      if (shop === "choice") priceRef.push(`ë³´í˜¸ëŒ€ 5,000 / ì¥ê°‘ 5,000`);
      else priceRef.push(`ë³´í˜¸ëŒ€ 5,000`);
      priceRef.push(`í—¬ë©§orê³ ê¸€ 10,000 / í—¬ë©§+ê³ ê¸€ 15,000`);
      priceRef.push("");
      priceRef.push(`<ì£¼ì¤‘>`);
      priceRef.push(`[3ì‹œê°„ê¶Œ] ëŒ€ì¸ 44,000 / ì†Œì¸ 35,000`);
      priceRef.push(`[4ì‹œê°„ê¶Œ] ëŒ€ì¸ 51,000 / ì†Œì¸ 41,000`);
      priceRef.push(`[6ì‹œê°„ê¶Œ] ëŒ€ì¸ 58,000 / ì†Œì¸ 47,000`);
      priceRef.push("");
      priceRef.push(`<ì£¼ë§>`);
      priceRef.push(`[3ì‹œê°„ê¶Œ] ëŒ€ì¸ 54,000 / ì†Œì¸ 43,000`);
      priceRef.push(`[4ì‹œê°„ê¶Œ] ëŒ€ì¸ 61,000 / ì†Œì¸ 49,000`);
      priceRef.push(`[6ì‹œê°„ê¶Œ] ëŒ€ì¸ 69,000 / ì†Œì¸ 55,000`);

      $("q_priceRef").textContent = priceRef.join("\n");
    }

    $("btnResetQuote").addEventListener("click", () => {
        $("q_date").value = "";
        $("q_dateLabel").value = "";

        // âœ… ë¦¬í”„íŠ¸ê¶Œ ì¸ì› ì´ˆê¸°í™” (ê°€ì¥ ì¤‘ìš”)
        [
            "q_lift3_adult","q_lift3_child",
            "q_lift4_adult","q_lift4_child",
            "q_lift6_adult","q_lift6_child"
        ].forEach(id => setCount(id, 0));

        // ì¥ë¹„ / ì˜ë¥˜ / ì˜µì…˜
        [
            "q_equipment","q_skiate",
            "q_clothHigh","q_clothPremium",
            "q_pad","q_helmet","q_helmetSet", "q_gloves"
        ].forEach(id => setCount(id, 0));

        setCount("q_lessonTeam", 0);

        // íŒ€ë³„ ìƒì„¸ ì˜ì—­ ë¹„ìš°ê¸°
        const wrap = $("lessonTeamsWrap");
        if (wrap) wrap.innerHTML = "";

        // lessonState ì¨ì„œ íŒ€ ìƒíƒœ ì €ì¥í•˜ê³  ìˆë‹¤ë©´ ê°™ì´ ì´ˆê¸°í™”
        if (typeof lessonState !== "undefined") {
            for (const k in lessonState) delete lessonState[k];
        }    


        $("q_memo").value = "";
      
        // ì¿ í° ì´ˆê¸°í™”
        couponApplied = false;
        couponDiscountRate = 10;
        $("couponSelect").value = "10";
        $("couponInput").style.display = "none";
        $("couponInput").value = "";
        refreshCouponUI();

      
        $("q_warn").textContent = "";
        syncDayTypePill();
        updateQuote();
        toast("ì´ˆê¸°í™” ì™„ë£Œ");
    });

    $("btnCopyQuote").addEventListener("click", async () => {
      updateQuote();
      const text = $("q_breakdown").textContent;
      await navigator.clipboard.writeText(text);
      toast("ê²¬ì  ë³µì‚¬ ì™„ë£Œ");
    });

    // -------------------------
    // ì˜ˆì•½ í™”ë©´ ë¡œì§
    // -------------------------
    $("r_date").addEventListener("change", () => {
      const info = getDayTypeFromDate($("r_date").value);
      $("r_dateLabel").value = info ? `${info.iso} (${info.dow} Â· ${info.label})` : "";
      syncDayTypePill();
      updateReserveOutput();
    });

    $("r_timeUnknown").addEventListener("change", () => {
      const unk = $("r_timeUnknown").checked;
      $("r_time").disabled = unk;
      if (unk) $("r_time").value = "";
      updateReserveOutput();
    });

    $("q_memo").addEventListener("input", updateQuote);
    $("q_showReserveLink")?.addEventListener("change", updateQuote);
    document.getElementById("q_showReserveLink")?.addEventListener("change", updateQuote);

    document.querySelectorAll('input[name="r_lift"]').forEach(r => {
      r.addEventListener("change", updateReserveOutput);
    });

    ["r_name","r_phone","r_memo"].forEach(id => {
      $(id).addEventListener("input", updateReserveOutput);
    });

    function enforceReserveRules() {
        const adult = readCount("r_adult");
        const child = readCount("r_child");
        const liftPeople = adult + child;

        const rental = readCount("r_rental");

        // âœ… ì´ ì¸ì› = ë¦¬í”„íŠ¸ê¶Œ ì¸ì› vs ë Œíƒˆ ì¸ì› ì¤‘ í° ê°’
        const total = Math.max(liftPeople, rental);

        // ê¸°ì¡´ UIê°€ r_totalPeopleì„ "ë¦¬í”„íŠ¸ê¶Œ ì¸ì›"ì´ë¼ê³  ì“°ê³  ìˆì§€ë§Œ,
        // ë„¤ ìš”êµ¬ëŒ€ë¡œë¼ë©´ ì—¬ê¸°ì—” "ì´ ì¸ì›" ê°œë…ì´ ë“¤ì–´ê°€ëŠ” ê²Œ ë§ìŒ
        $("r_totalPeople").textContent = String(total);

        // âœ… ì´ì œ ë Œíƒˆ ì¸ì›ì€ ë¦¬í”„íŠ¸ ì¸ì›ê³¼ ë¬´ê´€í•˜ê²Œ ì¡°ì ˆ ê°€ëŠ¥
        // (ì›í•˜ë©´ ìƒí•œë§Œ 99ë¡œ ì œí•œ)
        setCount("r_rental", clamp(rental, 0, 99));
    }


    function updateReserveOutput() {
      enforceReserveRules();

      const name = $("r_name").value.trim();
      const phone = $("r_phone").value.trim();
      const dateInfo = getDayTypeFromDate($("r_date").value);
      const time = $("r_timeUnknown").checked ? "ë¯¸ì •" : ($("r_time").value || "ë¯¸ì •");
      const lift = document.querySelector('input[name="r_lift"]:checked')?.value || "none";
      const liftLabel = (lift === "none") ? "ì—†ìŒ" : (lift === "unknown") ? "ë¯¸ì •" : `${lift}ì‹œê°„ê¶Œ`;

      const adult = readCount("r_adult");
      const child = readCount("r_child");
      const liftPeople = adult + child;

      const rental = readCount("r_rental");
      const total = Math.max(liftPeople, rental);

      const memo = $("r_memo").value.trim() || "-";

      const lines = [];
      lines.push("[ì˜ˆì•½ì •ë³´]");
      lines.push(`ì„±í•¨: ${name || "-"}`);
      lines.push(`ì—°ë½ì²˜: ${phone || "-"}`);
      lines.push("");
      lines.push(`ì´ìš©ì¼: ${dateInfo ? `${dateInfo.iso} (${dateInfo.dow} Â· ${dateInfo.label})` : "-"}`);
      lines.push(`ë°©ë¬¸ì‹œê°„: ${time}`);
      lines.push(`ë¦¬í”„íŠ¸ê¶Œ: ${liftLabel}`);
      lines.push("");
      lines.push(`ì¸ì›: ëŒ€ì¸ ${adult} / ì†Œì¸ ${child}`);
      lines.push(`ë Œíƒˆ ì¸ì›: ${rental}`);
      lines.push(`ì´ ì¸ì›: ${total}ëª…`);
      lines.push("");
      lines.push(`ë©”ëª¨: ${memo}`);

      $("r_output").value = lines.join("\n");
    }

    $("btnResetReserve").addEventListener("click", () => {
      ["r_name","r_phone","r_memo"].forEach(id => $(id).value = "");
      $("r_date").value = "";
      $("r_dateLabel").value = "";
      $("r_time").value = "";
      $("r_timeUnknown").checked = false;
      $("r_time").disabled = false;

      ["r_adult","r_child","r_rental"].forEach(id => setCount(id, 0));
      $("r_totalPeople").textContent = "0";
      updateReserveOutput();
      syncDayTypePill();
      toast("ì´ˆê¸°í™” ì™„ë£Œ");
    });

    $("btnCopyReserve").addEventListener("click", async () => {
      updateReserveOutput();
      await navigator.clipboard.writeText($("r_output").value);
      toast("ì •ë¦¬ë³¸ ë³µì‚¬ ì™„ë£Œ");
    });

    $("btnCopyReserveWithQuote").addEventListener("click", async () => {
      updateReserveOutput();
      updateQuote();
      const combined =
        $("r_output").value +
        "\n\n" +
        "--------------------\n" +
        $("q_breakdown").textContent;
      await navigator.clipboard.writeText(combined);
      toast("ì •ë¦¬ë³¸+ê²¬ì  ë³µì‚¬ ì™„ë£Œ");
    });

    // ì´ˆê¸° ë Œë”
    


    /** ë¼ë²¨/íŒíŠ¸ë§Œ ë™ê¸°í™” (ì´ë²¤íŠ¸ ë“±ë¡ ê¸ˆì§€) */
    function syncClothLabel() {
    const shop = document.querySelector('input[name="shop"]:checked')?.value || "choice";
    const S = PRICES.shops[shop];

    // ë¼ë²¨
    const labelEl = document.getElementById("clothHighLabel");
    if (labelEl) labelEl.textContent = S.clothTypeLabel;

    // ë‚ ì§œ ê¸°ì¤€ (ì£¼ì¤‘/ì£¼ë§)
    const dateInfo = getDayTypeFromDate(document.getElementById("q_date").value);
    const dayType = dateInfo ? dateInfo.dayType : "weekday";

    // ì˜ë¥˜ ê°€ê²© íŒíŠ¸
    const highHint = document.getElementById("clothHighHint");
    const premiumHint = document.getElementById("clothPremiumHint");

    if (highHint) highHint.textContent = `${S.clothHigh[dayType].toLocaleString()}ì› / 1ì¸`;
    if (premiumHint) premiumHint.textContent = `${S.clothPremium[dayType].toLocaleString()}ì› / 1ì¸`;

    // ì¥ë¹„ ê°€ê²© íŒíŠ¸ (ìŠ¤ì¹´ì´/êµ­ëŒ€ 20,000)
    const equipmentHint = document.getElementById("equipmentHint");
    if (equipmentHint) {
        const equipmentPrice = (shop === "sky" || shop === "national") ? 20000 : 15000;
        equipmentHint.textContent = `${equipmentPrice.toLocaleString()}ì› / 1ì¸`;
    }

    }
    function syncGlovesUI() {
        const shop = document.querySelector('input[name="shop"]:checked')?.value || "choice";
        const row = document.getElementById("glovesRow");
        if (!row) return;

        if (shop === "choice") {
            row.style.display = "";
        } else {
            row.style.display = "none";
            setCount("q_gloves", 0);
        }
    }

    /** âœ… ì´ë²¤íŠ¸ëŠ” â€œí•¨ìˆ˜ ë°–ì—ì„œâ€ ë‹¨ 1ë²ˆë§Œ ë“±ë¡ */
    document.querySelectorAll('input[name="shop"]').forEach(r => {
    r.addEventListener("change", () => {
        syncClothLabel();
        syncGlovesUI();   // â† â­ ì´ ì¤„ ì¶”ê°€
        updateQuote();
    });
    });


    // ğŸ“… ë²„íŠ¼ í´ë¦­ ì‹œ ë‹¬ë ¥ ì—´ê¸°
    document.addEventListener("click", (e) => {
    const btn = e.target.closest(".dateBtn");
    if (!btn) return;

    const wrap = btn.closest(".dateWrap");
    const input = wrap?.querySelector('input[type="date"]');
    if (!input) return;

    if (typeof input.showPicker === "function") input.showPicker(); // í¬ë¡¬/ì—£ì§€
    else input.focus(); // fallback
    });
    $("btnCoupon10").addEventListener("click", () => {
        couponApplied = !couponApplied; // ìƒíƒœë§Œ í† ê¸€
        refreshCouponUI();               // UIëŠ” ì—¬ê¸°ì„œë§Œ ê°±ì‹ 
        updateQuote();
    });

    $("couponSelect").addEventListener("change", (e) => {
        if (e.target.value === "custom") {
            $("couponInput").style.display = "block";
            if (!$("couponInput").value) $("couponInput").value = "10";
            couponDiscountRate = Number($("couponInput").value || 0);
        } else {
            $("couponInput").style.display = "none";
            couponDiscountRate = Number(e.target.value);
        }

        refreshCouponUI(); // âœ… ë²„íŠ¼ ë¬¸êµ¬ëŠ” ì—¬ê¸°ì„œ
        updateQuote();
    });

    $("couponInput").addEventListener("input", (e) => {
        couponDiscountRate = Number(e.target.value || 0);

        refreshCouponUI(); // âœ…
        updateQuote();
    });


    updateQuote();
    updateReserveOutput();
    syncDayTypePill();
    syncClothLabel();
    syncGlovesUI();
    document.addEventListener("DOMContentLoaded", () => {
      const countEl = document.getElementById("q_faqCount");
      if (countEl) {
        countEl.addEventListener("change", renderFaqFields);
      }
      renderFaqFields(); // ìµœì´ˆ 1íšŒ ë Œë” (0ê°œë©´ ì•„ë¬´ê²ƒë„ ì•ˆ ë³´ì„)
    });
  </script>
</body>
</html>
